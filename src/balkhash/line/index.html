<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>OSM только вдоль GeoJSON-линии</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .mask-pane { z-index: 450; pointer-events: none; }
    .mask-fill { fill: rgba(255,255,255,1); }
    .data-pane { z-index: 460; }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Turf для буфера из линии -->
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
(async () => {
  // 1) ССЫЛКА НА ТВОЙ ФАЙЛ
  const RAW_URL = "https://raw.githubusercontent.com/adlenadlen/standart/main/src/balkhash/line/map.geojson";

  // 2) Инициализация карты
  const map = L.map('map', { preferCanvas: true });
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap contributors"
  }).addTo(map);

  map.createPane('mask');  map.getPane('mask').classList.add('mask-pane');
  map.createPane('data');  map.getPane('data').classList.add('data-pane');

  // 3) Загружаем GeoJSON (LineString/MultiLineString)
  const resp = await fetch(RAW_URL, { headers: { "Accept": "application/json" }});
  if (!resp.ok) throw new Error("Не удалось загрузить GeoJSON");
  const lineGeoJSON = await resp.json();

  // 4) Рисуем саму линию (тонкая голубая)
  const lineLayer = L.geoJSON(lineGeoJSON, {
    style: { color: "#3b82f6", weight: 3 }
  }).addTo(map);

  const bounds = lineLayer.getBounds();
  if (bounds.isValid()) {
    map.fitBounds(bounds.pad(0.15));
    map.setMaxBounds(bounds.pad(0.7));
  }

  // 5) Строим ПОЛИГОНАЛЬНУЮ МАСКУ вокруг линии
  // Ширина коридора (по 250 м в каждую сторону). Поставь своё значение.
  const BUFFER_METERS = 250;

  // Нормализуем к FeatureCollection
  const fc = lineGeoJSON.type === "FeatureCollection"
    ? lineGeoJSON
    : { type: "FeatureCollection", features: [lineGeoJSON] };

  // Делаем буфер + объединяем (на случай множественных линий)
  const buffered = turf.buffer(fc, BUFFER_METERS, { units: "meters" });
  const dissolved = turf.dissolve(buffered); // один многоугольник

  // Отрисуем границы буфера поверх (для контроля)
  L.geoJSON(dissolved, {
    style: { color: "#22c55e", weight: 1, fill: false },
    pane: 'data'
  }).addTo(map);

  // 6) SVG-маска: тайлы видны только внутри буфера
  const svg = L.svg({ pane: 'mask' }).addTo(map);
  const svgRoot = svg._root;
  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  path.setAttribute('class', 'mask-fill');
  path.setAttribute('fill-rule', 'evenodd');
  svgRoot.appendChild(p
